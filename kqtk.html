<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Chi ti·∫øt b√†i vi·∫øt</title>
  <link rel="stylesheet" href="Styles/1.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <div class="mark">TH</div>
        <h1>Tr∆∞·ªùng Ti·ªÉu h·ªçc A Phong Th·∫°nh T√¢y A</h1>
      </div>
      <div class="search-area">
        <input id="search-box" placeholder="üîé T√¨m..." onkeypress="handleSearch(event)">
      </div>
      <div id="user-info" class="user-actions"></div>
    </div>

    <main class="card">
      <div id="post-detail">
        <h2 class="detail-title" id="post-title"></h2>
        <p class="meta" id="post-meta"></p>
        <div id="post-content"></div>
      </div>
    </main>
  </div>

  <script type="module">
    import { db } from './Scripts/firebase.js';
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const id = localStorage.getItem("postId");

    async function load() {
      if (!id) {
        document.getElementById('post-title').textContent = "Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt.";
        return;
      }

      const snap = await getDoc(doc(db, "posts", id));
      if (!snap.exists()) {
        document.getElementById('post-title').textContent = "B√†i vi·∫øt kh√¥ng t·ªìn t·∫°i.";
        return;
      }

      const d = snap.data();
      document.getElementById('post-title').textContent = d.title;
      document.getElementById('post-meta').textContent =
        `${d.category || ''} ‚Ä¢ ${d.createdAt ? new Date(d.createdAt.toDate()).toLocaleString() : ''} ‚Ä¢ T√°c gi·∫£: ${d.author || ''}`;
      document.getElementById('post-content').innerHTML =
        `<div style="white-space: pre-wrap; margin-top: 12px;">${d.content}</div>`;
    }

    load();

    window.handleSearch = (e) => {
      if (e.key === 'Enter') {
        const k = document.getElementById('search-box').value.trim().toLowerCase();
        if (k) {
          localStorage.setItem('searchKeyword', k);
          window.location.href = 'search.html';
        }
      }
    };
  </script>
</body>
</html>
